
Data engineering and Analytics isn't just about writing queries.
ğ˜ğ˜µ'ğ˜´ ğ˜¢ğ˜£ğ˜°ğ˜¶ğ˜µ ğ˜¸ğ˜³ğ˜ªğ˜µğ˜ªğ˜¯ğ˜¨ ğ˜šğ˜”ğ˜ˆğ˜™ğ˜› ğ˜²ğ˜¶ğ˜¦ğ˜³ğ˜ªğ˜¦ğ˜´. ğŸš€


Let me break down a pro-level SQL technique

SELECT

 department,

 employee_name,

 salary,



 FIRST_VALUE(salary) OVER (
 PARTITION BY department
 ORDER BY salary
 ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
 ) AS department_lowest_salary,


 LAST_VALUE(salary) OVER (
 PARTITION BY department
 ORDER BY salary
 ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
 ) AS department_highest_salary



FROM employee_salaries;



By default, window functions like LAST_VALUE() have a tricky default frame that only looks backwards.


ğ˜“ğ˜¦ğ˜µ'ğ˜´ ğ˜£ğ˜³ğ˜¦ğ˜¢ğ˜¬ ğ˜¥ğ˜°ğ˜¸ğ˜¯ ğ˜¸ğ˜©ğ˜¢ğ˜µ'ğ˜´ ğ˜©ğ˜¢ğ˜±ğ˜±ğ˜¦ğ˜¯ğ˜ªğ˜¯ğ˜¨:

ğ”ğğğğ”ğğƒğ„ğƒ ğğ‘ğ„ğ‚ğ„ğƒğˆğğ†: Starts at the first row of the partition
ğ”ğğğğ”ğğƒğ„ğƒ ğ…ğğ‹ğ‹ğğ–ğˆğğ†: Goes all the way to the last row of the partition

This combination tells SQL: "ğ˜“ğ˜°ğ˜°ğ˜¬ ğ˜¢ğ˜µ ğ˜Œğ˜ğ˜Œğ˜™ğ˜  ğ˜³ğ˜°ğ˜¸ ğ˜ªğ˜¯ ğ˜µğ˜©ğ˜ªğ˜´ ğ˜¥ğ˜¦ğ˜±ğ˜¢ğ˜³ğ˜µğ˜®ğ˜¦ğ˜¯ğ˜µ, ğ˜ªğ˜¨ğ˜¯ğ˜°ğ˜³ğ˜¦ ğ˜µğ˜©ğ˜¦ ğ˜¥ğ˜¦ğ˜§ğ˜¢ğ˜¶ğ˜­ğ˜µ ğ˜¸ğ˜ªğ˜¯ğ˜¥ğ˜°ğ˜¸ğ˜ªğ˜¯ğ˜¨"

ğ“ğ²ğ©ğ¢ğœğšğ¥ ğƒğğŸğšğ®ğ¥ğ­ ğğğ¡ğšğ¯ğ¢ğ¨ğ« (ğŸš« ğ–ğ¢ğ­ğ¡ğ¨ğ®ğ­ ğğ®ğ« ğ“ğ«ğ¢ğœğ¤):

-- This would only look backwards, missing true max
LAST_VALUE(salary) OVER (
 PARTITION BY department
 ORDER BY salary
) AS incorrect_max_salary


ğğ®ğ« ğ“ğ«ğ¢ğœğ¤'s (âœ… ğ–ğ¢ğ­ğ¡ ğ…ğ«ğšğ¦ğ ğ‚ğ¥ğšğ®ğ¬ğ):

LAST_VALUE(salary) OVER (
 PARTITION BY department
 ORDER BY salary
 ROWS BETWEEN UNBOUNDED PRECEDING AND UNBOUNDED FOLLOWING
) AS true_department_max_salary

ğ‘ğğšğ¥-ğ–ğ¨ğ«ğ¥ğ ğˆğ¦ğ©ğšğœğ­:

1) Compute true department-wide min/max in ONE query
2) Avoid multiple passes through the data
3) Create fast, readable analytics

This works in Snowflake, BigQuery, and modern data warehouses. 

This gives you the ACTUAL department-wide min and max, not a limited window that can give misleading results.



ğƒğšğ­ğš ğğ§ğ ğ¢ğ§ğğğ«ğ¢ğ§ğ  ğ¢ğ¬ğ§'ğ­ ğ£ğ®ğ¬ğ­ ğšğ›ğ¨ğ®ğ­ ğ°ğ«ğ¢ğ­ğ¢ğ§ğ  ğªğ®ğğ«ğ¢ğğ¬. ğˆğ­'ğ¬ ğšğ›ğ¨ğ®ğ­ ğ°ğ«ğ¢ğ­ğ¢ğ§ğ  ğ’ğŒğ€ğ‘ğ“ ğªğ®ğğ«ğ¢ğğ¬. ğŸš€


If you've read so far, do LIKE the post ğŸ‘
 
ğ.ğ’:
Learn no-nonsense AWS Data Engineering with 372+ others:
https://aws.sachin.cloud
&
ğ–ğ¡ğšğ­ğ¬ğšğ©ğ© group for notification : https://w.sachin.cloud
(phone privacy ensured, you won't see others )

https://www.linkedin.com/posts/sachincw_126-complex-sql-queriespdf-activity-7315674866848837632-P-YU?utm_source=share&utm_medium=member_desktop&rcm=ACoAAARSzbgBGEbWHnTkxyPnkFaeZcnK-pW0lqg


https://sachinchandrashekhar.com/page/AWS-Data-Engineering-MasterClass
